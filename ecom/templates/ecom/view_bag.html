{% extends "ecom/cust_master.html" %} {% block content %}{% load static %}
<!--  -->
<div class="container">
    <div class="row" style="min-height: 300px;">
        <h2>Your Bag</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Image</th>
                    <th scope="col">Product Name</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Total Price</th>
                </tr>
            </thead>
            <tbody>
                {% for order in bagdata %}
                <tr>
                    <!-- <td></td> -->

                    {% for product in productdata %} {% if order.product_id_id == product.id %}
                    <td><img src="/media/{{ product.img }}" alt="" srcset="" height="100px" width="100px"></td>
                    <td>{{ product.title }}</td>
                    <td>
                        <input type="number" onchange="update_quantity(this,'{{order.id}}','{{ product.price }}','price{{ forloop.counter }}')" value="{{ order.quantity }}" min="1">
                    </td>
                    <td><span>&#8377;</span><input type="number" id="price{{ forloop.counter }}" value="{{ product.price }}" min="1" readonly></td>
                    {% endif %}{% endfor %}
                </tr>
                {% endfor %}

            </tbody>
        </table>
        <button id="rzp-button1"> Pay </button>
    </div>
</div>
<!-- Razor pay integration started -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    var options = {
        "key": "rzp_test_jznmHCFBf6ZMUd", // Enter the Key ID generated from the Dashboard
        "amount": "50000", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "Acme Corp",
        "description": "Test Transaction",
        "image": "https://example.com/your_logo",
        "id": "1234",
        // "order_id": "order_9A33XWu170gUtm", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function(response) {
            alert(response.razorpay_payment_id);
            //alert(response.razorpay_id);
            // alert(response.razorpay_order_id);
            // alert(response.razorpay_signature)
        },
        "prefill": {
            "name": "Gaurav Kumar",
            "email": "gaurav.kumar@example.com",
            "contact": "9999999999"
        },
        "notes": {
            "address": "Razorpay Corporate Office"
        },
        "theme": {
            "color": "#3399cc"
        }
    };
    var rzp1 = new Razorpay(options);
    rzp1.on('payment.failed', function(response) {
        alert(response.error.code);
        alert(response.error.description);
        alert(response.error.source);
        alert(response.error.step);
        alert(response.error.reason);
        // alert(response.error.metadata.order_id);
        alert(response.error.metadata.payment_id);
    });
    document.getElementById('rzp-button1').onclick = function(e) {
        rzp1.open();
        e.preventDefault();
    }
</script>
<!-- End of razor pay integration -->
<script>
    function update_quantity(quanity, id, price, priceid) {
        console.log(quanity.value);
        console.log("price" + price);
        console.log(typeof(quanity.value))
        console.log(typeof(id))
        console.log(id);
        console.log('priceid' + priceid);
        totalprice = parseInt(price) * parseInt(quanity.value);
        console.log(totalprice);
        $("#" + priceid + "").val(totalprice);
        $.ajax({
            url: 'updateQuantity',
            type: 'get',
            data: {
                quanity: parseInt(quanity.value),
                id: id,
            },
            success: function(response) {
                console.log(response.status);
                if (response.status == "success") {
                    console.log(response.status);
                    load_data()
                }
            }
        })
    }

    function load_data() {
        $.ajax({
            url: '/ecom/viewBag',
            type: 'POST',
            success: function(response) {

            }
        })
    }
</script>
{% endblock %}